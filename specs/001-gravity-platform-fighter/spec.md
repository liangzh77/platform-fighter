# Feature Specification: 重力平台对战游戏

**Feature Branch**: `001-gravity-platform-fighter`
**Created**: 2025-10-12
**Status**: Draft
**Input**: User description: "写一个有重力的双人对战游戏,核心玩法是玩家1和2控制角色在界面上的三个分别在左上,中下,右上的平台上打斗。玩家可以选择角色A和角色B:角色都有一个大范围短距离的10点攻击力的技能3秒冷却,一个小范围长距离三十点伤害的技能5秒冷却,一个五秒冷却的和另一个玩家瞬间换位置的的技能和一个大招:A角色的大招是一个小范围贯穿屏幕80点攻击的技能冷却时间20秒,B角色的大招是一个40攻击中范围贯穿屏幕的技能15秒冷却。每个角色都有100滴血和三次复活(血量没了或者掉出屏幕算死亡)复活在中间平台上并获得3秒无敌"

## User Scenarios & Testing *(mandatory)*

### User Story 1 - 基础对战循环 (Priority: P1)

两名玩家在同一台设备上(或通过网络)进行1v1对战。玩家选择角色(A或B),然后在三个平台上移动、跳跃、使用技能攻击对手。当一方的生命值归零或掉出屏幕时死亡并复活,直到某一方用完所有复活次数后游戏结束。

**Why this priority**: 这是游戏的核心玩法循环,没有它游戏无法成立。必须首先实现才能验证游戏是否有趣。

**Independent Test**: 可通过两名玩家完成一场完整对战(从角色选择到一方胜利)来独立测试,验证基本战斗机制、生命系统和胜负判定是否正常工作。

**Acceptance Scenarios**:

1. **Given** 游戏启动, **When** 两名玩家各自选择角色A或B, **Then** 双方角色出现在中间平台上,显示生命值100和复活次数3
2. **Given** 对战进行中, **When** 玩家按下移动键, **Then** 角色在平台上左右移动
3. **Given** 角色站在平台上, **When** 玩家按下跳跃键, **Then** 角色向上跳跃并受到重力影响落回平台
4. **Given** 角色A使用技能1命中角色B, **When** 技能生效, **Then** 角色B生命值减少10点
5. **Given** 角色生命值归零, **When** 死亡判定触发, **Then** 该角色在中间平台复活,复活次数减1,获得3秒无敌状态(无敌时角色闪烁或有视觉标识)
6. **Given** 角色掉出屏幕边界, **When** 离开可视区域, **Then** 该角色死亡并在中间平台复活
7. **Given** 某玩家复活次数为0且再次死亡, **When** 死亡触发, **Then** 游戏结束,显示对方玩家获胜

---

### User Story 2 - 技能战斗系统 (Priority: P2)

玩家使用四个不同的技能进行战斗:近距离范围技能、远距离精准技能、位置交换技能和角色特有的大招。每个技能都有冷却时间限制,玩家需要根据战况选择合适的技能时机。

**Why this priority**: 技能系统是游戏深度的核心,区分了不同的战术玩法。虽然重要,但可以在基础移动和攻击后再实现。

**Independent Test**: 可通过让玩家使用所有四个技能并观察效果、冷却时间和视觉反馈来独立测试。

**Acceptance Scenarios**:

1. **Given** 技能1冷却完成, **When** 玩家按下技能1键, **Then** 角色前方大范围短距离区域内的敌人受到10点伤害,技能进入3秒冷却
2. **Given** 技能2冷却完成, **When** 玩家按下技能2键, **Then** 角色朝向方向发射长距离小范围弹道,命中敌人造成30点伤害,技能进入5秒冷却
3. **Given** 技能3冷却完成, **When** 玩家按下技能3键, **Then** 该玩家与对方玩家的位置瞬间交换,技能进入5秒冷却
4. **Given** 角色A的大招冷却完成, **When** 玩家按下大招键, **Then** 从角色位置发射小范围贯穿全屏的攻击,命中敌人造成80点伤害,技能进入20秒冷却
5. **Given** 角色B的大招冷却完成, **When** 玩家按下大招键, **Then** 从角色位置发射中范围贯穿全屏的攻击,命中敌人造成40点伤害,技能进入15秒冷却
6. **Given** 技能处于冷却中, **When** 玩家尝试使用该技能, **Then** 技能无法释放,界面显示剩余冷却时间
7. **Given** 角色处于无敌状态(刚复活), **When** 受到任何技能攻击, **Then** 不受伤害,生命值不变

---

### User Story 3 - 平台移动与重力系统 (Priority: P2)

游戏场景包含三个固定平台(左上、中下、右上),角色在平台间通过跳跃移动。角色始终受到向下的重力影响,可以在空中进行有限的方向控制。

**Why this priority**: 平台和重力系统定义了游戏的空间战术层面,影响走位和技能释放时机,是游戏特色的重要部分。

**Independent Test**: 可通过控制角色在三个平台间移动并测试重力、跳跃和边界判定来独立验证。

**Acceptance Scenarios**:

1. **Given** 角色站在任意平台上, **When** 角色走出平台边缘, **Then** 角色开始向下坠落(受重力影响)
2. **Given** 角色在空中, **When** 角色接触到平台表面, **Then** 角色停止下落并可以在平台上行走
3. **Given** 角色在左上平台, **When** 玩家向右跳跃并控制方向, **Then** 角色可以跳到中间平台或继续跳到右上平台
4. **Given** 角色在中间平台, **When** 玩家向上跳跃, **Then** 角色可以跳到左上或右上平台
5. **Given** 角色在空中移动, **When** 角色接触屏幕边界, **Then** 角色死亡(除非处于无敌状态)
6. **Given** 角色持续下落, **When** 角色掉出屏幕底部, **Then** 角色死亡

---

### User Story 4 - 角色选择与游戏流程 (Priority: P3)

游戏开始时,玩家进入角色选择界面,选择角色A或角色B。选择完成后进入对战场景,对战结束后显示胜利画面和重新开始选项。

**Why this priority**: 这是游戏的外围流程,虽然对完整体验很重要,但可以在核心玩法验证后再完善。

**Independent Test**: 可通过从启动游戏到选择角色、完成对战、查看结果、重新开始的完整流程来测试。

**Acceptance Scenarios**:

1. **Given** 游戏启动, **When** 进入主界面, **Then** 显示"开始游戏"按钮
2. **Given** 主界面, **When** 点击"开始游戏", **Then** 进入角色选择界面
3. **Given** 角色选择界面, **When** 玩家1选择角色A或B,玩家2选择角色A或B, **Then** 显示双方已选择的角色,启用"开始对战"按钮
4. **Given** 双方选择完成, **When** 点击"开始对战", **Then** 进入对战场景,双方角色出现在中间平台
5. **Given** 对战结束, **When** 某方获胜, **Then** 显示胜利画面(胜者名称/编号),提供"再来一局"和"返回主菜单"选项
6. **Given** 胜利画面, **When** 点击"再来一局", **Then** 返回角色选择界面
7. **Given** 胜利画面, **When** 点击"返回主菜单", **Then** 返回主界面

---

### Edge Cases

- **同时死亡**: 如果两名玩家同时因技能或坠落死亡(在同一帧),双方都会复活并继续对战,各自复活次数减1。特殊情况:如果双方都在最后一条命且同时死亡,则继续复活再战,直到某一方单独死亡为止
- **技能碰撞**: 如果两个远程技能(技能2或大招)在空中相遇,是否会相互抵消或穿透?假设:所有弹道穿透,不会相互影响
- **位置交换边界**: 如果玩家在平台边缘使用位置交换技能,交换后对方是否会直接掉下去?假设:交换后双方都获得0.5秒的短暂着陆稳定时间,防止立即掉落
- **空中使用技能**: 角色在空中(跳跃或坠落时)是否可以使用技能?假设:所有技能都可以在空中使用
- **连击打断**: 角色受到攻击时是否会被击退或硬直?假设:受到伤害时角色会有短暂击退效果(0.3秒),防止无限连击
- **复活无敌利用**: 玩家是否可以利用复活的3秒无敌时间强行攻击对手?假设:允许,这是战术的一部分
- **冷却时间显示**: 技能冷却时UI如何显示剩余时间?假设:每个技能图标上显示倒计时数字或冷却遮罩
- **大招蓄力**: 大招是否需要蓄力或瞄准,还是瞬发?假设:瞬发,按键立即释放
- **平台穿透**: 角色从下往上跳跃时能否穿过平台?假设:可以从下往上穿过平台,只有从上往下时会站在平台上

## Requirements *(mandatory)*

### Functional Requirements

#### 核心战斗机制
- **FR-001**: 系统必须支持两名玩家同时控制各自角色
- **FR-002**: 系统必须提供角色A和角色B供选择,两个角色的区别仅在于大招(技能4)
- **FR-003**: 每个角色必须拥有100点初始生命值
- **FR-004**: 每个角色必须拥有3次复活机会(即总共可承受4次死亡)
- **FR-005**: 当角色生命值降至0或掉出屏幕时,必须判定为死亡
- **FR-006**: 角色死亡后必须在中间平台复活,并获得3秒无敌状态
- **FR-007**: 无敌状态期间角色不受任何伤害,且必须有明显的视觉标识(如闪烁效果)
- **FR-008**: 当某玩家用完所有复活次数后再次死亡,必须判定游戏结束,对方获胜

#### 技能系统
- **FR-009**: 所有角色必须拥有技能1:大范围短距离攻击,伤害10点,冷却时间3秒
- **FR-010**: 所有角色必须拥有技能2:小范围长距离弹道攻击,伤害30点,冷却时间5秒
- **FR-011**: 所有角色必须拥有技能3:与对方玩家瞬间交换位置,冷却时间5秒
- **FR-012**: 角色A的大招(技能4)必须为小范围贯穿全屏攻击,伤害80点,冷却时间20秒
- **FR-013**: 角色B的大招(技能4)必须为中范围贯穿全屏攻击,伤害40点,冷却时间15秒
- **FR-014**: 技能处于冷却期间不可使用,必须显示剩余冷却时间
- **FR-015**: 游戏开始时,所有技能必须处于可用状态(冷却完成)

#### 移动与物理系统
- **FR-016**: 角色必须能够在平台上左右移动
- **FR-017**: 角色必须能够跳跃,跳跃高度足以到达上层平台
- **FR-018**: 角色必须持续受到向下的重力作用
- **FR-019**: 角色必须能够在空中进行左右方向控制
- **FR-020**: 角色可以从下往上穿过平台,但从上往下时会站立在平台上
- **FR-021**: 角色接触屏幕边界(左、右、下)时必须判定死亡

#### 场景与平台
- **FR-022**: 游戏场景必须包含三个固定平台:左上、中下、右上
- **FR-023**: 左上平台位置约在屏幕宽度的25%位置,高度约70%
- **FR-024**: 中间平台位置约在屏幕宽度的50%位置,高度约40%
- **FR-025**: 右上平台位置约在屏幕宽度的75%位置,高度约70%
- **FR-026**: 所有平台必须有足够宽度供角色站立和移动(建议至少容纳1.5个角色宽度)

#### 游戏流程
- **FR-027**: 游戏必须提供主菜单界面,包含"开始游戏"选项
- **FR-028**: 游戏必须提供角色选择界面,允许两名玩家分别选择角色A或B
- **FR-029**: 角色选择完成后必须进入对战场景
- **FR-030**: 对战结束后必须显示胜利画面,标明获胜玩家
- **FR-031**: 胜利画面必须提供"再来一局"和"返回主菜单"选项

#### 输入控制
- **FR-032**: 玩家1必须使用键盘左侧按键控制(建议WASD移动 + QER技能 + 空格跳跃)
- **FR-033**: 玩家2必须使用键盘右侧按键控制(建议方向键移动 + UIO技能 + 数字0跳跃)
- **FR-034**: 技能按键必须映射到技能1、2、3、4(大招)

#### 视觉反馈
- **FR-035**: 必须实时显示双方角色的当前生命值
- **FR-036**: 必须实时显示双方角色的剩余复活次数
- **FR-037**: 必须显示每个技能的冷却状态
- **FR-038**: 技能命中时必须有视觉效果(如闪光、震动、伤害数字)
- **FR-039**: 角色死亡时必须有明显的动画或效果
- **FR-040**: 复活无敌状态必须有持续的视觉标识

### Key Entities

- **角色(Character)**: 玩家控制的战斗单位,拥有生命值、复活次数、位置、速度、朝向、技能冷却状态、无敌状态等属性
- **技能(Skill)**: 角色可使用的攻击能力,包含伤害值、范围、距离、冷却时间、当前冷却剩余时间等属性
- **平台(Platform)**: 固定的可站立区域,包含位置、宽度、高度等属性
- **对战状态(Match State)**: 记录当前游戏进行状态,包括玩家选择的角色、当前得分、游戏阶段(选择/对战中/结束)等
- **伤害判定(Hit Detection)**: 技能攻击的碰撞检测,确定技能是否命中对手

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: 两名玩家能够在30秒内完成角色选择并进入对战
- **SC-002**: 游戏在双人对战时保持至少30帧每秒的流畅度(目标60FPS)
- **SC-003**: 玩家输入(移动、跳跃、技能)响应延迟低于100毫秒
- **SC-004**: 一场完整对战(从开始到一方获胜)平均耗时2-5分钟
- **SC-005**: 技能冷却倒计时误差在±0.1秒以内
- **SC-006**: 角色跳跃从中间平台到上层平台的成功率达到95%以上(通过合理的跳跃力度设计)
- **SC-007**: 在对战过程中没有明显的卡顿或掉帧(帧时间方差<16ms)
- **SC-008**: 玩家能够在3次尝试内理解所有技能的用法(通过观察效果和反馈)
- **SC-009**: 死亡和复活的过渡动画在2秒内完成,不打断游戏节奏
- **SC-010**: 位置交换技能的视觉效果清晰可见,玩家能够立即识别交换发生(反应时间<0.5秒)

## Assumptions

1. **游戏平台**: 假设游戏在现代网页浏览器中运行,使用键盘作为输入设备
2. **双人模式**: 假设双人游戏通过本地分屏(同一台电脑的不同按键)进行,而非在线多人
3. **画面方向**: 假设游戏使用横屏布局,屏幕宽度大于高度
4. **角色平衡性**: 假设角色A和B基本平衡,A的大招伤害高但冷却长,B的大招伤害低但冷却短且范围更大
5. **技能范围定义**:
   - "大范围"约为角色前方180度扇形,距离约2个角色身位
   - "小范围"约为角色前方60度锥形
   - "中范围"约为角色前方120度锥形
   - "长距离"约为全屏幕宽度
   - "短距离"约为屏幕宽度的20%
6. **伤害平衡**: 假设100生命值的设计允许:
   - 技能1需命中10次击杀
   - 技能2需命中4次击杀
   - 技能组合可产生战术多样性
7. **重力强度**: 假设重力加速度设置为让角色从上层平台自由落下到下层平台耗时约0.8-1秒
8. **击退效果**: 假设受到攻击时有轻微击退(约0.5个角色宽度),防止无限连击但不至于击飞出平台
9. **技能动画**: 假设所有技能释放和命中效果都有简短动画(0.2-0.5秒),提供视觉反馈但不影响操作流畅度

## Out of Scope (本版本不包含)

- 单人AI对战模式
- 在线多人联机功能
- 超过2个角色的选择
- 可解锁的皮肤或外观定制
- 背景音乐和音效(可作为后续增强)
- 排行榜或战绩记录系统
- 关卡或场景选择(只有一个固定场景)
- 教学模式或新手引导
- 暂停功能(对战中无法暂停)
- 回放功能
- 观战模式
- 更多平台数量或可破坏的平台
- 道具或增益系统
- 角色升级或成长系统
